# logs
- clocked in 12:15 PM
- tried understanding PCI, PCI like bus, peripherals, ENETC, fabric controller, felix switch fabric, internal bus, PCI bridge
- tried understanding commmands ($ls -al /dev/ptp* )($lspci )
- tried understanding PTP (Precision Time Protocol), PHC (PTP Hardware Clock), Qbv (Time-Aware Shaper - IEEE 802.1Qbv)
- commands to syncronize hardware clock using 
    $sudo apt install linuxptp
    $sudo ptp4l -i eno0 -m -S
    $sudo phc2sys -s eno0 -c CLOCK_REALTIME -w -m
- Implement Qbv (Optional, Advanced)
    - tc (traffic control) command in Linux to configure the "qdisc" (queueing discipline) for a network port.
    - write a script that uses tc to set up the time-aware shaper and provide it with the schedule of gates to open and close. This is an advanced topic to tackle after you have PTP working perfectly.
- Kernel Patch or Mainline Kernel?
    - Mainline Kernel: The core support for PTP (ptp4l, phc2sys) and the APIs for traffic control (tc) have been in the standard, mainline Linux kernel for many years
    - Kernel Patches/Drivers: The specific drivers that make the PTP hardware on the LS1028A visible as ptp0 and expose the Qbv capabilities of the ENETC hardware are provided by NXP. Your kernel version 6.6.52-rt43-gfa9d239dbfb9 shows this:
        - 6.6.52: The base mainline kernel version.
        - rt43: The Real-Time patchset has been applied, which improves scheduling for time-critical tasks.
        - gfa9d239dbfb9: This is a git hash indicating that NXP-specific patches have been applied on top of everything else.
    - using standard Linux tools that are talking to NXP-provided drivers to control NXP hardware.
- Understand Drivers and Source Code
    - PTP Driver: The driver for the PTP clock is likely in drivers/ptp/ptp_qoriq.c or similar. This code is what creates the /dev/ptp devices.
    - Network Driver (ENETC): The driver for your Ethernet ports is the most important one. Look in drivers/net/ethernet/freescale/enetc/. This directory contains the code that controls the Ethernet hardware, including the TSN features like Qbv. Reading enetc_qos.c or enetc_tsn.c (if they exist) would show you how the driver configures the hardware based on the tc commands you send from userspace.
    - Device Tree: Look in arch/arm64/boot/dts/freescale/fsl-ls1028a-rdb.dts. This file describes the hardware to the kernel. You will see entries for the ENETC ports and the PTP clocks, telling the kernel which driver to load for which piece of hardware.
    - How to approach this: Start by looking at the Device Tree file (.dts) to see how the hardware is described. Then, find the driver mentioned in the device tree (e.g., the compatible = "fsl,enetc" line tells you to look for the enetc driver) and start reading the C code to see how it works.
- device driver source code
    - ptp_qoriq.c (The PTP driver)
        ~/Projects/flexbuild/components_lsdk2506/linux/linux/drivers/ptp/ptp_qoriq.c
    - enetc driver directory (The Ethernet and TSN driver)
        ~/Projects/flexbuild/components_lsdk2506/linux/linux/drivers/net/ethernet/freescale/enetc
- fsl-ls1028a-rdb.dts (The Device Tree Source file)
    - This file exists for both the kernel and the U-Boot bootloader. The primary one you'll want to inspect for the running OS is the kernel version:
    - Kernel: ~/Projects/flexbuild/components_lsdk2506/linux/linux/arch/arm64/boot/dts/freescale/fsl-ls1028a-rdb.dts
    - U-Boot: ~/Projects/flexbuild/components_lsdk2506/bsp/uboot/arch/arm/dts/fsl-ls1028a-rdb.dts

# notes
- $ls -al /dev/ptp* (PTP Clocks)
  crw------- 1 root root 249, 0 Jun 26  2025 /dev/ptp0
  crw------- 1 root root 249, 1 Jun 26  2025 /dev/ptp1
    - command lists the device files related to PTP (Precision Time Protocol). PTP is a protocol used to synchronize clocks across a network with extremely high accuracy, often to within a microsecond or better. This is a cornerstone of Time-Sensitive Networking (TSN).
    - crw-------: This indicates that these are character device files, which are special files that act as a direct interface to a hardware device driver.
    - ptp0 and /dev/ptp1: Your system has two hardware clocks capable of PTP. These device files allow software to directly read and control these high-precision clocks.
    - 249, 0 and 249, 1: These are the major/minor device numbers that the kernel uses to identify the specific driver and device instance.

- $lspci (List PCI Devices)
  0000:00:00.0 Ethernet controller: Freescale Semiconductor Inc Device e100 (rev 01)
  0000:00:00.1 Ethernet controller: Freescale Semiconductor Inc Device e100 (rev 01)
  0000:00:00.2 Ethernet controller: Freescale Semiconductor Inc Device e100 (rev 01)
  0000:00:00.3 System peripheral: Freescale Semiconductor Inc Device ee01 (rev 01)
  0000:00:00.4 System peripheral: Freescale Semiconductor Inc Device ee02 (rev 01)
  0000:00:00.5 Fabric controller: Freescale Semiconductor Inc Device eef0 (rev 01)
  0000:00:00.6 Ethernet controller: Freescale Semiconductor Inc Device e100 (rev 01)
  0000:00:1f.0 Generic system peripheral [0807]: Freescale Semiconductor Inc Device e001 (rev 01)
  0001:00:00.0 PCI bridge: Freescale Semiconductor Inc Device 82c0 (rev 10)
  0002:00:00.0 PCI bridge: Freescale Semiconductor Inc Device 82c0 (rev 10)
    - command lists all the hardware devices connected to the PCI (Peripheral Component Interconnect) bus. On an SoC like the LS1028A, many of the "peripherals" are actually integrated directly onto the chip and communicate internally over a PCI-like bus.
    - Inside your LS1028A chip, there is an internal bus that uses the PCI standard.
    - Connected to this bus are several peripherals, including multiple ENETC (Ethernet) controllers and a Fabric Controller (the manager for the Felix Switch).
    - The CPU uses this internal bus to send and receive data from all these peripherals.
    - There is also a PCI Bridge connected to the internal bus. This bridge's other end connects to the physical PCIe slots on your motherboard, so you can add more hardware.
    -     - When you run lspci, the kernel is walking along this internal highway system and asking each "building" (peripheral) connected to it, "Who are you?" and then reporting the answers.
    - 0000:00:00.0 Ethernet controller: ...: You see multiple Ethernet controllers. These are the physical hardware blocks (ENETC) that correspond to the network interfaces you saw with the ip a command (eno0, eno2, etc.).
    - 0000:00:00.5 Fabric controller: ...: This is the most interesting entry. This is the Felix switch fabric, the core hardware of the integrated TSN network switch. lspci sees it as a distinct piece of hardware on the internal bus.
    - 0001:00:00.0 PCI bridge: ...: These are bridges that connect the processor's internal bus to the external PCIe slots on your board. This allows you to plug in additional hardware like another network card or a storage controller.